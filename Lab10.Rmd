---
title: "NotTeamOnelab10"
author: "David Orozco, Ethan Schacht, Anderson Mun, Arie del Valle, Ryan Tate"
date: "March 20, 2019"
output: html_document
---

```{r}
library(tidyverse)
library(lubridate)
library(stringr)
library(data.table)

Questions <- read.csv("Questions_trunc.csv")
Answers <- read.csv("answers_trunc.csv")

# merged <- left_join(Questions, Answers, by = c("Id" = "ParentId")) as NAs in date set
merged <- inner_join(Questions, Answers, by = c("Id" = "ParentId"))

```
```{r}
merged2 <- merged %>%
  mutate(question_title = Title, question_date = CreationDate.x, answer_date = CreationDate.y,
         question_score = Score.x, answer_score = Score.y,
         question_body = Body.x, answer_body = Body.y,
         question_id = Id, question_asker_id = OwnerUserId.x, question_answerer_id = OwnerUserId.y) %>%
  select(-CreationDate.x, -CreationDate.y, -Score.x, -Score.y, -Body.x, -Body.y, -Id, -X.x, -X.y, -Id.y, -OwnerUserId.x, -OwnerUserId.y, -Title)

merged3 <- merged2[c(8,9,1:2,4,6,10,3,5,7)]

merged3$question_date <- ymd_hms(merged3$question_date)
merged3$answer_date <- ymd_hms(merged3$answer_date)
```
****
#### Team Section
****
* Question: What is the relationship between the timeliness of an answer and its score?

```{r}

```

**** 
#### Arie's Section
****

```{r, echo=FALSE}
questionT<- merged3%>%
  select(question_title,answer_score, question_score, question_date, answer_body)%>%
  group_by(question_title, question_date, answer_body)%>%
  summarise(avg_Qscore = mean(question_score), avg_Ascore = mean(answer_score))

titlesPython <- questionT%>%
  filter(str_detect(question_title, "python"))

answerPython <- questionT%>%
  filter(str_detect(answer_body, "python"))


# compares avg question score and answer score of quesition titles that are about python
ggplot(data = titlesPython, mapping = aes(x = avg_Qscore, y = avg_Ascore ))+
  geom_point()+geom_smooth(method = lm)+
  ggtitle("Question titles about python : Average question score vs. Average answer score")+
  xlab("Average Answer Score")+
  ylab("Average Question Score")

correlation1 <-cor(titlesPython$avg_Qscore, titlesPython$avg_Ascore )
correlation1

# compares avg quesiton score and answer score of anser titles that are about python
ggplot(data = answerPython, mapping = aes(x = avg_Qscore, y = avg_Ascore ))+
  geom_point()+geom_smooth(method = lm)+
  ggtitle("Answers about python: Average question score vs. Average answer score")+
  xlab("Average Answer Score")+
  ylab("Average Question Score")

correlation2 <- cor(answerPython$avg_Qscore, answerPython$avg_Ascore)
correlation2

```

**** 
#### David's Section
****

```{r, echo=FALSE}
gut <- merged3 %>% group_by(question_id) %>% mutate(ave = mean(answer_score)) %>% mutate(length = str_length(question_title)) %>% arrange(desc(ave)) 
 
get <- gut[,c(1,3,11,12)]  %>% unique()  
got <- get %>% filter(length < 5000, ave > 0, ave < 25) 
 
ggplot(data = get, mapping = aes(x = length, y = ave))+ 
  geom_point() 
```

**** 
#### Ethan's Section
****

* Question: How does user question/answer politeness affect the score of their post?

* Explanation: I decided to pursue this question because I'm curious as to how people behave in response to polite words or lack thereof.

```{r, echo=FALSE}

polite <- merged3 %>%
  mutate(polite_question = ifelse(str_detect(question_body, "[T|t]hank you") | str_detect(question_body, "[T|t]hanks") |
         str_detect(question_body, "[P|p]lease") | str_detect(question_body, " [T|t]y "), "True", "False")) %>%
  mutate(polite_answer = ifelse(str_detect(answer_body, "[T|t]hank you") | str_detect(answer_body, "[T|t]hanks") |
         str_detect(answer_body, "[P|p]lease") | str_detect(answer_body, " [T|t]y "), "True", "False")) %>%
  group_by(polite_answer, polite_question, question_id) %>%
  summarise(avg_question_score = mean(question_score), avg_answer_score = mean(answer_score))

polite2 <- polite %>%
  group_by(polite_answer, polite_question) %>% #Another group_by required to deal with repeated question id's as a result of joining datasets
  summarise(avg_question_score = mean(avg_question_score), avg_answer_score = mean(avg_answer_score), count = n()) %>%
  unite(`polite_answer + polite_question`, polite_answer, polite_question, sep = " + ")

polite3 <- polite2[c(1,3,2,4)]

ggplot(data = polite3) +
  geom_point(mapping = aes(x = `polite_answer + polite_question`, y = avg_question_score, size = count), color = "blue") +
  geom_point(mapping = aes(x = `polite_answer + polite_question`, y = avg_answer_score, size = count), color = "green") +
  xlab("Polite Answer + Polite Question (True or False)") +
  ylab("Average Score") +
  ggtitle("Stackoverflow Threads: Politeness vs. Question/Answer Score", subtitle = "Blue = Question Score; Green = Answer Score")

```

* Process: I first created two new variables using ifelse(), having logical values of True or False depending upon my system's detection of common polite words.  I detected my answer bodies and question bodies for the words "please" and "thank you" and variations of these phrases to achieve this.  I then grouped by my two new variables and the question ID to get average question and answer scores for the 4 variations of "politeness."  Finally, I graphed the 4 variations of True/False against their repsective average question and answer scores, also taking their grouped counts into account using "size = count".

* Findings: My hypothesis was that polite questions and answers would receive higher average scores.  I was mostly proven wrong, especially when it came to average question scores as polite questions averaged scores of approxiately 12 (between False + True and True + True) and less polite questions averaged scores above 30! (between False + False and True + False).  It is notable that we have a much higher sample size for less polite questions, but this difference is still quite significant.  There doesn't appear to be as strong of a correlation between answer politeness and answer score itself, though the strength of an answer score consistently depends on the strength of the question score on average (Ex: A polite answer plus a less polite question yielded the highest average question score, as well as the highest average answer score).  

* Explanation: It might be possible that more polite questions resulted in lower average question scores on StackOverflow because these types of questions reflect lack of knowledge on the subject as well as an undesirable informal approach to the complex subject of coding.  For example, people attempting to simply convince others to hand them code rather than show interest in more constructive help may be more likely to use words such as "please" or "thank you" in their questions.  Furthermore, average answer scores could correlate with average question scores because conversations may either go in a helpful direction or unhelpful direction on both ends.  Both the questioner and answerer can also both recieve the benefits of a popular thread, and both will also receieve the consequences of an unpopular thread.

**** 
#### Ryan's Section
****

```{r, echo=FALSE}

```

**** 
#### Anderson's Section (David pt 2)
****

```{r, echo=FALSE}

```